<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Authorize — Clawnads</title>
  <link rel="icon" type="image/svg+xml" href="/clawnads-favicon-white.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <style>
    html, body { margin: 0; min-height: 100vh; background: var(--color-bg-deep); }
    body { color: var(--color-text-primary); font-family: var(--font-sans); display: flex; flex-direction: column; }
    .oc-header { display: flex; align-items: center; padding: var(--space-10) var(--space-16); }
    .oc-header img { height: 28px; width: auto; opacity: 0.4; }
    .oc-body { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: var(--space-8); }

    /* Operator PFP — shown above the card when logged in */
    .oc-operator-pfp {
      width: 56px; height: 56px; border-radius: 50%;
      border: 2px solid var(--color-border);
      margin-bottom: calc(-28px - 1px);
      position: relative; z-index: 1;
      background: var(--color-bg-elevated);
      overflow: hidden;
    }
    .oc-operator-pfp img { width: 100%; height: 100%; object-fit: cover; }

    .consent-card {
      background: var(--color-bg-card);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-2xl);
      padding: var(--space-12);
      padding-top: var(--space-16);
      max-width: 420px;
      width: 100%;
      box-shadow: var(--shadow-elevated);
    }
    .consent-card.no-pfp { padding-top: var(--space-12); }

    .consent-header { text-align: center; margin-bottom: var(--space-8); }
    .consent-crab { margin-bottom: var(--space-6); }
    .consent-crab img { opacity: 0.7; }
    .consent-title { font-size: var(--text-xl); font-weight: 700; margin-bottom: var(--space-2); }
    .consent-subtitle { font-size: var(--text-sm); color: var(--color-text-secondary); line-height: var(--leading-relaxed); }

    /* dApp context row — small icon + name */
    .consent-dapp-row {
      display: flex; align-items: center; gap: var(--space-4);
      padding: var(--space-4) var(--space-6);
      background: var(--color-bg-elevated); border-radius: var(--radius-lg);
      margin-bottom: var(--space-8);
    }
    .consent-dapp-icon {
      width: 36px; height: 36px; border-radius: var(--radius-lg);
      background: linear-gradient(135deg, var(--color-accent), #a855f7);
      display: flex; align-items: center; justify-content: center;
      font-size: var(--text-sm); font-weight: 700; color: white; flex-shrink: 0;
      overflow: hidden;
    }
    .consent-dapp-icon img { width: 100%; height: 100%; object-fit: cover; }
    .consent-dapp-name { font-size: var(--text-sm); font-weight: 600; }
    .consent-dapp-desc { font-size: var(--text-xs); color: var(--color-text-tertiary); }

    /* Agent row (when pre-selected) */
    .consent-agent {
      display: flex; align-items: center; gap: var(--space-4);
      padding: var(--space-4) var(--space-6);
      background: var(--color-bg-elevated); border-radius: var(--radius-lg);
      margin-bottom: var(--space-8);
    }
    .consent-agent-icon {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(135deg, var(--color-accent), #a855f7);
      display: flex; align-items: center; justify-content: center;
      font-size: var(--text-sm); font-weight: 700; color: white; flex-shrink: 0;
      overflow: hidden;
    }
    .consent-agent-icon img { width: 100%; height: 100%; object-fit: cover; }
    .consent-agent-name { font-size: var(--text-base); font-weight: 600; }
    .consent-agent-wallet { font-size: var(--text-xs); color: var(--color-text-tertiary); font-family: var(--font-mono); }

    /* Agent dropdown — custom with PFP */
    .consent-agent-picker {
      margin-bottom: var(--space-8);
    }
    .consent-agent-picker-label {
      font-size: var(--text-xs); font-weight: 600; color: var(--color-text-muted);
      text-transform: uppercase; letter-spacing: 0.06em;
      margin-bottom: var(--space-3);
    }
    .consent-agent-picker-btn {
      width: 100%; display: flex; align-items: center; gap: var(--space-4);
      padding: var(--space-4) var(--space-6);
      background: var(--color-bg-elevated); border: 1px solid var(--color-border);
      border-radius: var(--radius-lg); cursor: pointer;
      font-family: var(--font-sans); color: var(--color-text-primary);
      transition: border-color var(--transition-fast);
      position: relative;
    }
    .consent-agent-picker-btn:hover { border-color: var(--color-border-subtle); }
    .consent-agent-picker-btn::after {
      content: ''; position: absolute; right: var(--space-6); top: 50%; transform: translateY(-50%);
      width: 10px; height: 6px;
      background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%2371717a' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
    }
    .consent-agent-picker-pfp {
      width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0; overflow: hidden;
      background: linear-gradient(135deg, var(--color-accent), #a855f7);
      display: flex; align-items: center; justify-content: center;
      font-size: var(--text-xs); font-weight: 700; color: white;
    }
    .consent-agent-picker-pfp img { width: 100%; height: 100%; object-fit: cover; }
    .consent-agent-picker-info { flex: 1; min-width: 0; text-align: left; }
    .consent-agent-picker-name { font-size: var(--text-sm); font-weight: 600; }
    .consent-agent-picker-wallet { font-size: var(--text-xs); color: var(--color-text-tertiary); font-family: var(--font-mono); }
    .consent-agent-picker-menu {
      display: none; position: absolute; left: 0; right: 0; top: calc(100% + 4px);
      background: var(--color-bg-card); border: 1px solid var(--color-border);
      border-radius: var(--radius-lg); box-shadow: var(--shadow-elevated);
      z-index: 10; padding: var(--space-2) 0; max-height: 200px; overflow-y: auto;
    }
    .consent-agent-picker-menu.open { display: block; }
    .consent-agent-picker-option {
      display: flex; align-items: center; gap: var(--space-4);
      padding: var(--space-3) var(--space-6); cursor: pointer;
      transition: background var(--transition-fast);
    }
    .consent-agent-picker-option:hover { background: var(--color-bg-elevated); }
    .consent-agent-picker-option.selected { background: rgba(124,92,255,0.1); }

    /* Scopes */
    .consent-scopes { margin-bottom: var(--space-8); }
    .consent-scope-item {
      display: flex; align-items: center; gap: var(--space-3);
      padding: var(--space-3) 0;
    }
    .consent-scope-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
    .consent-scope-dot.ro { background: var(--color-accent); }
    .consent-scope-dot.rw { background: var(--color-success); }
    .consent-scope-name { font-size: var(--text-sm); font-weight: 600; color: var(--color-text-secondary); min-width: 70px; }
    .consent-scope-badge {
      font-size: 10px; font-weight: 600; padding: 1px 6px;
      border-radius: var(--radius-pill); white-space: nowrap; margin-left: auto;
    }
    .consent-scope-badge.ro {
      background: rgba(124, 92, 255, 0.1); color: var(--color-accent); border: 1px solid rgba(124, 92, 255, 0.2);
    }
    .consent-scope-badge.rw {
      background: rgba(34, 197, 94, 0.1); color: var(--color-success); border: 1px solid rgba(34, 197, 94, 0.2);
    }

    /* Limits */
    .consent-limits {
      background: var(--color-bg-elevated); border-radius: var(--radius-lg);
      padding: var(--space-5) var(--space-6); margin-bottom: var(--space-10);
    }
    .consent-limits-title {
      font-size: var(--text-xs); color: var(--color-text-muted);
      text-transform: uppercase; letter-spacing: 0.06em;
      font-weight: 600; margin-bottom: var(--space-3);
    }
    .consent-limit-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; }
    .consent-limit-label { font-size: var(--text-xs); color: var(--color-text-tertiary); }
    .consent-limit-value { font-size: var(--text-xs); color: var(--color-text-secondary); font-family: var(--font-mono); font-weight: 500; }

    /* Step 1: Sign in with X */
    .consent-login { text-align: center; }
    .consent-login-text { font-size: var(--text-sm); color: var(--color-text-secondary); margin-bottom: var(--space-6); line-height: var(--leading-relaxed); }

    .consent-btn-x {
      display: inline-flex; align-items: center; justify-content: center; gap: var(--space-3);
      width: 100%; padding: var(--space-5) var(--space-8);
      background: var(--color-text-primary); color: var(--color-bg-deep);
      border-radius: var(--radius-pill); font-size: var(--text-base); font-weight: 600;
      font-family: var(--font-sans); border: none; cursor: pointer;
      text-decoration: none; transition: opacity var(--transition-fast);
    }
    .consent-btn-x:hover { opacity: 0.9; }

    /* Step 2: Approve/Deny */
    .consent-actions { display: flex; gap: var(--space-4); }
    .consent-btn {
      flex: 1; padding: var(--space-5) var(--space-8);
      border-radius: var(--radius-pill); font-size: var(--text-base); font-weight: 600;
      font-family: var(--font-sans); cursor: pointer; border: none;
      transition: all var(--transition-fast);
    }
    .consent-btn-approve { background: var(--color-text-primary); color: var(--color-bg-deep); }
    .consent-btn-approve:hover { opacity: 0.9; }
    .consent-btn-deny { background: var(--color-bg-elevated); color: var(--color-text-secondary); border: 1px solid var(--color-border); }
    .consent-btn-deny:hover { color: var(--color-text-primary); }

    .consent-footer { text-align: center; font-size: var(--text-xs); color: var(--color-text-muted); margin-top: var(--space-6); line-height: var(--leading-relaxed); }

    .consent-error { text-align: center; padding: var(--space-12); }
    .consent-error-title { font-size: var(--text-lg); font-weight: 600; margin-bottom: var(--space-4); }
    .consent-error-desc { font-size: var(--text-sm); color: var(--color-text-secondary); }
    .consent-loading { text-align: center; padding: var(--space-16); color: var(--color-text-tertiary); }
    .consent-no-agents { text-align: center; font-size: var(--text-sm); color: var(--color-text-tertiary); padding: var(--space-8) 0; }

    @media (max-width: 480px) {
      .oc-header { padding: var(--space-6) var(--space-8); }
      .oc-body { padding: var(--space-4); align-items: flex-start; padding-top: var(--space-8); }
      .consent-card { padding: var(--space-8); }
      .consent-card.no-pfp { padding-top: var(--space-8); }
    }
  </style>
</head>
<body>

  <header class="oc-header"><img src="/clawnads-logo-white.svg" alt="Clawnads"></header>
  <div class="oc-body">
    <div class="oc-operator-pfp" id="operator-pfp" style="display:none"></div>
    <div class="consent-card no-pfp" id="consent-card">
      <div class="consent-loading" id="consent-loading">Loading...</div>
    </div>
  </div>

  <script>
    const SCOPE_INFO = {
      balance: { label: 'Balance', desc: 'View wallet balance', access: 'ro' },
      swap: { label: 'Swap', desc: 'Swap tokens within daily cap', access: 'rw' },
      send: { label: 'Send', desc: 'Send tokens within daily cap', access: 'rw' },
      sign: { label: 'Sign', desc: 'Sign messages', access: 'rw' },
      messages: { label: 'Messages', desc: 'Read and send messages', access: 'rw' },
      profile: { label: 'Profile', desc: 'View agent profile', access: 'ro' },
    };

    const params = new URLSearchParams(window.location.search);
    const flowId = params.get('flow');

    if (!flowId) {
      showError('Missing flow', 'No authorization flow specified.');
    } else {
      loadConsentDetails();
    }

    async function loadConsentDetails() {
      try {
        const resp = await fetch(`/oauth/consent/details?flow=${flowId}`);
        const data = await resp.json();

        if (!data.success) {
          showExpired();
          return;
        }

        renderConsent(data);
      } catch (err) {
        showExpired();
      }
    }

    function renderConsent(data) {
      const card = document.getElementById('consent-card');
      const pfpEl = document.getElementById('operator-pfp');

      // Show operator PFP above the card when logged in
      if (data.operatorAuthenticated && data.operatorProfileImageUrl) {
        pfpEl.innerHTML = `<img src="${escAttr(data.operatorProfileImageUrl)}" alt="@${escAttr(data.operatorUsername)}">`;
        pfpEl.style.display = '';
        card.classList.remove('no-pfp');
      }

      const loggedIn = data.operatorAuthenticated;

      // --- dApp context row (icon + name) — shown in both steps ---
      const dappIconHtml = data.dapp.iconUrl
        ? `<img src="${escAttr(data.dapp.iconUrl)}" alt="">`
        : `<img src="/default-dapp-icon.svg" alt="" style="width:100%;height:100%;padding:4px;opacity:0.5;">`;

      const dappRowHtml = `
        <div class="consent-dapp-row">
          <div class="consent-dapp-icon">${dappIconHtml}</div>
          <div>
            <div class="consent-dapp-name">${escHtml(data.dapp.name)}</div>
            ${data.dapp.description ? `<div class="consent-dapp-desc">${escHtml(data.dapp.description)}</div>` : ''}
          </div>
        </div>
      `;

      let html = '';

      if (!loggedIn) {
        // ========== STEP 1: Not logged in — just log in ==========
        html += `
          <div class="consent-header">
            <div class="consent-crab"><img src="/happy-crab.svg" alt="" width="120" height="66"></div>
            <div class="consent-title">Log in</div>
            <div class="consent-subtitle"><strong>${escHtml(data.dapp.name)}</strong> is requesting permissions</div>
          </div>
        `;

        html += dappRowHtml;

        html += `
          <div class="consent-login">
            <a href="/oauth/consent/auth?flow=${flowId}" class="consent-btn-x">
              <svg viewBox="0 0 24 24" width="15" height="15" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
              Sign in with X
            </a>
          </div>
        `;
      } else {
        // ========== STEP 2: Logged in — title, dApp, scopes, agent, limits, buttons ==========
        html += `
          <div class="consent-header">
            <div class="consent-title">Approve access</div>
            <div class="consent-subtitle">Review the requested permissions</div>
          </div>
        `;

        html += dappRowHtml;
        html += renderScopes(data.scopes);

        // Agent: either pre-selected row or custom dropdown with PFPs
        if (data.agent) {
          // Single agent (pre-selected in authorize URL)
          const walletShort = data.agent.wallet
            ? data.agent.wallet.slice(0, 6) + '\u2026' + data.agent.wallet.slice(-4)
            : 'No wallet';
          const avatarHtml = data.agent.avatarUrl
            ? `<img src="${escAttr(data.agent.avatarUrl)}" alt="">`
            : escHtml((data.agent.name || '?')[0].toUpperCase());

          html += `
            <div class="consent-agent">
              <div class="consent-agent-icon">${avatarHtml}</div>
              <div class="consent-agent-info">
                <div class="consent-agent-name">${escHtml(data.agent.name)}</div>
                <div class="consent-agent-wallet">${walletShort}</div>
              </div>
            </div>
          `;
        } else if (data.claimedAgents && data.claimedAgents.length > 0) {
          const first = data.claimedAgents[0];
          const firstWallet = first.wallet ? first.wallet.slice(0, 6) + '\u2026' + first.wallet.slice(-4) : '';
          const firstAvatar = first.avatarUrl
            ? `<img src="${escAttr(first.avatarUrl)}" alt="">`
            : escHtml((first.name || '?')[0].toUpperCase());

          html += `
            <div class="consent-agent-picker">
              <div class="consent-agent-picker-label">Agent</div>
              <div style="position:relative;">
                <button type="button" class="consent-agent-picker-btn" id="agent-picker-btn">
                  <div class="consent-agent-picker-pfp" id="picker-pfp">${firstAvatar}</div>
                  <div class="consent-agent-picker-info">
                    <div class="consent-agent-picker-name" id="picker-name">${escHtml(first.name)}</div>
                    <div class="consent-agent-picker-wallet" id="picker-wallet">${firstWallet}</div>
                  </div>
                </button>
                <div class="consent-agent-picker-menu" id="agent-picker-menu">`;
          for (let i = 0; i < data.claimedAgents.length; i++) {
            const a = data.claimedAgents[i];
            const w = a.wallet ? a.wallet.slice(0, 6) + '\u2026' + a.wallet.slice(-4) : '';
            const av = a.avatarUrl
              ? `<img src="${escAttr(a.avatarUrl)}" alt="">`
              : escHtml((a.name || '?')[0].toUpperCase());
            html += `
                  <div class="consent-agent-picker-option${i === 0 ? ' selected' : ''}" data-name="${escAttr(a.name)}" data-wallet="${escAttr(w)}" data-avatar="${escAttr(a.avatarUrl || '')}">
                    <div class="consent-agent-picker-pfp">${av}</div>
                    <div class="consent-agent-picker-info">
                      <div class="consent-agent-picker-name">${escHtml(a.name)}</div>
                      <div class="consent-agent-picker-wallet">${w}</div>
                    </div>
                  </div>`;
          }
          html += `
                </div>
              </div>
            </div>`;
        } else {
          html += `<div class="consent-no-agents">You don't have any claimed agents.</div>`;
        }

        // Show limits for the selected/first agent
        const limitsAgent = data.agent || (data.claimedAgents && data.claimedAgents[0]);
        if (limitsAgent) {
          html += renderLimits({
            maxPerTradeMON: limitsAgent.maxPerTradeMON || limitsAgent.limits?.maxPerTradeMON || '500',
            dailyCapMON: limitsAgent.dailyCapMON || limitsAgent.limits?.dailyCapMON || '2500'
          });
        }

        // Approve/Deny — only if there are agents to select
        const hasAgents = data.agent || (data.claimedAgents && data.claimedAgents.length > 0);
        if (hasAgents) {
          html += `
            <div class="consent-actions">
              <form method="POST" action="/oauth/consent/deny" style="flex:1;display:flex;">
                <input type="hidden" name="flow" value="${flowId}">
                <input type="hidden" name="csrf_token" value="${escAttr(data.csrfToken || '')}">
                <button type="submit" class="consent-btn consent-btn-deny" style="width:100%;">Deny</button>
              </form>
              <form method="POST" action="/oauth/consent/approve" style="flex:1;display:flex;" id="approve-form">
                <input type="hidden" name="flow" value="${flowId}">
                <input type="hidden" name="csrf_token" value="${escAttr(data.csrfToken || '')}">
                <input type="hidden" name="agent" value="${escAttr(data.agent?.name || (data.claimedAgents && data.claimedAgents[0]?.name) || '')}" id="approve-agent">
                <button type="submit" class="consent-btn consent-btn-approve" style="width:100%;">Approve</button>
              </form>
            </div>
          `;
        }
      }

      if (loggedIn) {
        html += `<div class="consent-footer">This app will not be able to bypass your platform limits.</div>`;
      }

      card.innerHTML = html;

      // Wire up custom agent picker
      const pickerBtn = document.getElementById('agent-picker-btn');
      const pickerMenu = document.getElementById('agent-picker-menu');
      const agentInput = document.getElementById('approve-agent');
      if (pickerBtn && pickerMenu) {
        pickerBtn.addEventListener('click', (e) => {
          e.preventDefault();
          pickerMenu.classList.toggle('open');
        });
        // Close on click outside
        document.addEventListener('click', (e) => {
          if (!pickerBtn.contains(e.target) && !pickerMenu.contains(e.target)) {
            pickerMenu.classList.remove('open');
          }
        });
        // Option selection
        pickerMenu.querySelectorAll('.consent-agent-picker-option').forEach(opt => {
          opt.addEventListener('click', () => {
            const name = opt.dataset.name;
            const wallet = opt.dataset.wallet;
            const avatarUrl = opt.dataset.avatar;
            // Update button display
            const pfpEl = document.getElementById('picker-pfp');
            pfpEl.innerHTML = avatarUrl
              ? `<img src="${escAttr(avatarUrl)}" alt="">`
              : escHtml((name || '?')[0].toUpperCase());
            document.getElementById('picker-name').textContent = name;
            document.getElementById('picker-wallet').textContent = wallet;
            // Update hidden input
            if (agentInput) agentInput.value = name;
            // Update selected state
            pickerMenu.querySelectorAll('.consent-agent-picker-option').forEach(o => o.classList.remove('selected'));
            opt.classList.add('selected');
            pickerMenu.classList.remove('open');
          });
        });
      }
    }

    function renderScopes(scopes) {
      let html = '<div class="consent-scopes">';
      for (const scope of scopes) {
        const info = SCOPE_INFO[scope.key] || { label: scope.key, desc: scope.key, access: 'ro' };
        const accessLabel = info.access === 'rw' ? 'Read & write' : 'Read only';
        html += `
          <div class="consent-scope-item">
            <div class="consent-scope-dot ${info.access}"></div>
            <div class="consent-scope-name">${escHtml(info.label)}</div>
            <span class="consent-scope-badge ${info.access}">${accessLabel}</span>
          </div>
        `;
      }
      html += '</div>';
      return html;
    }

    function renderLimits(limits) {
      if (!limits) return '';
      return `
        <div class="consent-limits">
          <div class="consent-limits-title">Platform limits apply</div>
          <div class="consent-limit-row">
            <span class="consent-limit-label">Max per trade</span>
            <span class="consent-limit-value">${escHtml(limits.maxPerTradeMON)} MON</span>
          </div>
          <div class="consent-limit-row">
            <span class="consent-limit-label">Daily cap</span>
            <span class="consent-limit-value">${escHtml(limits.dailyCapMON)} MON</span>
          </div>
          <div class="consent-limit-row">
            <span class="consent-limit-label">External sends</span>
            <span class="consent-limit-value">Require approval</span>
          </div>
        </div>
      `;
    }

    function showExpired() {
      const card = document.getElementById('consent-card');
      card.classList.add('no-pfp');
      card.style.border = 'none';
      card.style.background = 'none';
      card.style.boxShadow = 'none';
      card.innerHTML = `
        <div style="display:flex;flex-direction:column;align-items:center;text-align:center;padding:var(--space-8) 0;">
          <svg width="120" height="66" viewBox="0 0 100 55" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-bottom:var(--space-4);">
            <path d="M31.2099 45.0527C31.3816 45.1109 31.3138 45.0772 31.455 45.1611C32.589 45.8338 33.9277 46.2766 35.1815 46.668C34.9152 47.0227 34.2144 47.7101 33.8407 48.1631C31.988 50.4053 31.1523 52.0517 30.078 54.6768C30.0466 54.7368 29.9425 54.8509 29.8944 54.9082C29.6623 55.008 29.5453 55.0327 29.3007 54.9521C26.7826 54.1202 26.2768 50.8331 27.1229 48.6533C27.8846 46.6925 29.4041 45.8487 31.2099 45.0527ZM68.4852 45.1162C69.0621 45.0313 70.4841 45.959 70.994 46.3555C73.2311 48.0924 73.9772 51.4654 72.1386 53.7686C71.8237 54.1626 70.946 54.9875 70.3876 54.9941C70.1555 54.9966 70.0611 54.9048 69.911 54.751C69.638 54.2115 69.4323 53.5146 69.1386 52.9385C67.8436 50.3981 66.7678 48.5855 64.6503 46.7012C65.9883 46.2882 67.3058 45.8796 68.4852 45.1162ZM75.0976 41.0518C77.6372 41.2724 79.9589 41.8337 81.8173 43.6602C84.0285 45.8334 84.4932 49.2289 82.1864 51.5244C81.7756 51.934 81.3041 52.3176 80.9091 51.668C80.7124 51.3342 80.2057 50.7078 79.9491 50.3447C77.9262 47.488 74.8661 44.6508 71.4413 43.6699C72.4779 43.2153 73.1779 42.6328 74.0526 41.916C74.4626 41.5805 74.6178 41.3382 75.0976 41.0518ZM24.953 41.1348C25.2018 41.3081 25.712 41.8073 25.994 42.043C26.8766 42.7798 27.5021 43.1421 28.5184 43.6533C25.1888 44.6816 22.494 46.9576 20.4198 49.7178C20.1465 50.0822 19.9759 50.3986 19.6708 50.7539L19.6093 50.8242C19.3237 51.0898 19.1644 51.66 18.7499 51.9531C18.4278 51.9673 18.1104 51.9103 17.8778 51.6797C14.6291 48.4648 16.6499 43.7235 20.4257 42.0674C21.7284 41.4963 22.1907 41.3268 23.6132 41.1611C24.0699 41.107 24.4952 41.1264 24.953 41.1348ZM50.412 21.7686C53.8394 21.7239 58.3896 22.4166 61.6933 23.4268C65.9905 24.9067 70.3972 27.0117 73.7499 30.1299C76.8457 33.0097 78.0987 34.494 74.744 37.8359C70.2383 42.3231 64.4548 44.3785 58.3495 45.5908C55.5323 46.1503 52.3726 46.1943 49.5321 46.1885C45.1317 46.1735 41.0227 45.7038 36.8075 44.4365C31.8682 42.951 25.0118 39.5832 23.1005 34.5C23.4202 32.8506 24.6728 31.4788 25.8983 30.3223C29.2819 27.1293 33.7394 24.8807 38.1278 23.4404C39.442 22.9808 40.9113 22.8445 42.2343 22.5049C45.0465 21.7828 47.5417 21.7667 50.412 21.7686ZM58.2714 36.7139C53.1801 33.6592 46.8197 33.6593 41.7284 36.7139C41.018 37.1401 40.7875 38.0621 41.2138 38.7725C41.6401 39.4825 42.5612 39.7122 43.2714 39.2861C47.4127 36.8014 52.5871 36.8013 56.7284 39.2861C57.4386 39.7122 58.3597 39.4825 58.786 38.7725C59.2122 38.0621 58.9817 37.1401 58.2714 36.7139ZM87.0839 0C92.2005 0.461954 97.6246 4.65656 99.1727 9.55762C99.4757 10.5174 100.012 12.7205 99.9999 13.7236C99.8876 22.8356 91.6694 29.0257 83.3222 30.3164C80.1773 30.8026 79.3214 31.1331 76.5575 29.6787C76.208 29.4223 75.9171 29.2185 75.747 28.8213C75.8109 28.4152 76.4329 28.1363 76.828 27.9307C78.3952 27.1126 79.3915 25.4821 80.5927 24.458C79.8025 23.6312 79.3988 22.8348 78.8427 21.8477C76.0729 16.926 76.379 9.33155 80.6288 5.25586C81.4663 7.83061 84.0478 12.8462 86.3554 14.2852C86.9364 14.1176 87.3281 12.3194 87.4335 11.7666C88.1696 7.90054 87.8807 3.83257 87.0839 0ZM12.5751 0.0224609C12.674 0.0188039 12.7036 0.0419007 12.8056 0.0742188C12.8109 0.105027 12.4873 2.15371 12.4237 2.41699C11.9339 4.44521 11.9777 13.3766 13.5809 14.2666C13.9333 14.0704 14.3942 13.5678 14.6747 13.2617C16.8563 10.8818 18.1966 8.25826 19.329 5.29004C20.1374 6.22699 21.0198 7.43298 21.5643 8.54297C24.0217 13.5521 22.9833 20.4614 19.1913 24.5205C20.1645 25.3207 20.9902 26.6263 22.1073 27.4258C22.6294 27.799 23.8926 28.3973 24.0468 28.7637C23.9779 29.0606 23.8152 29.1944 23.6112 29.4258C20.8948 31.2226 19.7045 30.7652 16.7216 30.3389C10.3594 29.4295 3.61264 25.3576 1.07411 19.2295C-2.55085 10.4783 3.42841 1.30598 12.5751 0.0224609ZM62.164 8.62793C65.1164 8.21829 67.8443 10.2775 68.2694 13.2363C68.6944 16.1954 66.6565 18.9439 63.7089 19.3867C60.7381 19.8328 57.9722 17.7685 57.5438 14.7861C57.1159 11.804 59.1885 9.04114 62.164 8.62793ZM36.1874 8.64844C39.1466 8.16434 41.9354 10.1844 42.4081 13.1543C42.8805 16.1242 40.8577 18.9139 37.8954 19.3779C34.9473 19.8393 32.1821 17.8218 31.7118 14.8662C31.2419 11.911 33.243 9.13068 36.1874 8.64844ZM37.0683 11.2412C35.6404 11.2416 34.4827 12.4037 34.4823 13.8359C34.4824 15.2683 35.6403 16.4303 37.0683 16.4307C38.4963 16.4305 39.655 15.2684 39.6552 13.8359C39.6548 12.4036 38.4962 11.2414 37.0683 11.2412ZM62.9306 11.2412C61.5023 11.2413 60.3447 12.4033 60.3446 13.8359C60.3448 15.2685 61.5024 16.4296 62.9306 16.4297C64.3588 16.4297 65.5164 15.2686 65.5165 13.8359C65.5165 12.4032 64.3589 11.2412 62.9306 11.2412Z" fill="white"/>
          </svg>
          <div style="font-size:var(--text-xl);font-weight:700;margin-bottom:var(--space-4);">Session Expired</div>
          <div style="font-size:var(--text-sm);color:var(--color-text-secondary);line-height:var(--leading-relaxed);max-width:360px;">Start a new session from the app to continue.</div>
        </div>
      `;
    }

    function escHtml(str) {
      const div = document.createElement('div');
      div.textContent = str || '';
      return div.innerHTML;
    }

    function escAttr(str) {
      return (str || '').replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;');
    }
  </script>
</body>
</html>
